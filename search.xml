<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>在Windows 10 WSL2中使用图形界面（GUI）</title>
    <url>/2020/07/25/WSL2-Ubuntu-GUI/</url>
    <content><![CDATA[<p><img src="https://iamkyun-blog-post-img.oss-cn-shenzhen.aliyuncs.com/posts/WSL2-Ubuntu-GUI/1.jpg?x-oss-process=image/resize,h_256" alt="WSL"></p>
<h4 id="前言"><a class="header-anchor" href="#前言"></a>前言</h4>
<p>​		微软正在计划让WSL2支持基于RDP的GUI<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>，虽然这一特性目前还不可用，但我们还是能通过别的一些手段来达到目的。</p>
<h4 id="准备环境"><a class="header-anchor" href="#准备环境"></a>准备环境</h4>
<ul>
<li>
<p>Windows 10 （版本：2004）</p>
</li>
<li>
<p>WSL2（Ubuntu 20.04 LTS）（<a href="https://docs.microsoft.com/zh-cn/windows/wsl" target="_blank" rel="noopener">如何安装WSL2?</a>）</p>
</li>
</ul>
<h4 id="安装工具"><a class="header-anchor" href="#安装工具"></a>安装工具</h4>
<ol>
<li>先把<code>apt</code> <code>update</code> &amp; <code>upgrade</code></li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt -y upgrade</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>安装<code>XRDP</code><sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>（远程连接协议）、<code>Xfce</code><sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>（轻量级桌面环境，安装时会提示选择gdm3或lightdm，我选了gdm3）</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get purge xrdp</span><br><span class="line">sudo apt install -y xrdp</span><br><span class="line">sudo apt install -y xfce4</span><br><span class="line">sudo apt install -y xfce4-goodies</span><br></pre></td></tr></table></figure>
<ul>
<li>（<strong>非必须</strong>）更改<code>XRDP</code>的一些配置：增加bpp(bits per pixel)，让远程连接质量更好</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo sed -i 's/max_bpp=32/#max_bpp=32\nmax_bpp=128/g' /etc/xrdp/xrdp.ini</span><br><span class="line">sudo sed -i 's/xserverbpp=24/#xserverbpp=24\nxserverbpp=128/g' /etc/xrdp/xrdp.ini</span><br><span class="line">echo xfce4-session &gt; ~/.xsession</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>接下来更改<code>XRDP</code>的启动脚本，让它同时启动<code>Xfce</code></li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/xrdp/startwm.sh</span><br></pre></td></tr></table></figure>
<p>​		把文件的最后几行改成这样：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">test</span> -x /etc/X11/Xsession &amp;&amp; <span class="built_in">exec</span> /etc/X11/Xsession</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">exec</span> /bin/sh /etc/X11/Xsession</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> xfce</span></span><br><span class="line">startxfce4</span><br></pre></td></tr></table></figure>
<p><img src="https://iamkyun-blog-post-img.oss-cn-shenzhen.aliyuncs.com/posts/WSL2-Ubuntu-GUI/2.png?x-oss-process=image/resize,p_75" alt="code"></p>
<ol start="4">
<li>最后，启动<code>XDRP</code></li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo /etc/init.d/xrdp start</span><br></pre></td></tr></table></figure>
<h4 id="开始使用"><a class="header-anchor" href="#开始使用"></a>开始使用</h4>
<p>使用Windows的远程桌面连接，通过WSL的IP地址<code>:3389</code>，<code>3389</code>为默认端口，可以在配置<code>/etc/xrdp/xrdp.ini</code>中更改。</p>
<p><img src="https://iamkyun-blog-post-img.oss-cn-shenzhen.aliyuncs.com/posts/WSL2-Ubuntu-GUI/3.png" alt="Windows远程桌面连接"></p>
<p>用WSL的用户名和密码登录进系统</p>
<p><img src="https://iamkyun-blog-post-img.oss-cn-shenzhen.aliyuncs.com/posts/WSL2-Ubuntu-GUI/4.png" alt="登陆界面"></p>
<p>完成，最后成品：</p>
<p><img src="https://iamkyun-blog-post-img.oss-cn-shenzhen.aliyuncs.com/posts/WSL2-Ubuntu-GUI/5.png?x-oss-process=image/resize,p_50" alt="Ubuntu桌面"></p>
<h4 id="后言"><a class="header-anchor" href="#后言"></a>后言</h4>
<p>​		此文章所使用的方法是通过一些手段来让WSL2支持GUI，所以在使用的过程中略有繁琐和有一些不太完美的地方。相信之后微软推出的WSL2 GUI特性将会很好地支持这方面的使用。想要持续关注这一方面的信息，可以到<a href="https://devblogs.microsoft.com/commandline/" target="_blank" rel="noopener">微软的开发者博客</a>上关注这方面的内容。</p>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p><a href="https://devblogs.microsoft.com/commandline/the-windows-subsystem-for-linux-build-2020-summary/#wsl-gui" target="_blank" rel="noopener">The Windows Subsystem for Linux BUILD 2020 Summary</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn2" class="footnote-item"><p><a href="http://www.xrdp.org" target="_blank" rel="noopener">Website of XRDP</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn3" class="footnote-item"><p><a href="https://xfce.org/" target="_blank" rel="noopener">Website of Xfce</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>
]]></content>
      <categories>
        <category>操作系统</category>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>WSL</tag>
        <tag>Windows</tag>
        <tag>Linux</tag>
        <tag>指南</tag>
      </tags>
  </entry>
</search>
